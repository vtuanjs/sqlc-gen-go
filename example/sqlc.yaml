version: "2"

plugins:
  - name: golang
    wasm:
      url: file://../bin/sqlc-gen-go.wasm
      sha256: 3d401e627cc0a59ca38de09b287dd6e74b073a961e40891ebfb7047f3b987881

options:
  golang:
    # Override more fields if needed https://github.com/sqlc-dev/sqlc/blob/main/internal/codegen/golang/postgresql_type.go#L12
    overrides:
      - db_type: "pg_catalog.timestamptz"
        nullable: true
        go_type:
          import: "time"
          type: "Time"
          pointer: true
      - db_type: "pg_catalog.timestamptz"
        go_type:
          import: "time"
          type: "Time"
          pointer: false
      - db_type: "pg_catalog.timestamp"
        nullable: true
        go_type:
          import: "time"
          type: "Time"
          pointer: true
      - db_type: "pg_catalog.timestamp"
        go_type:
          import: "time"
          type: "Time"
          pointer: false
      - db_type: "timestamp"
        nullable: true
        go_type:
          import: "time"
          type: "Time"
          pointer: true
      - db_type: "timestamp"
        go_type:
          import: "time"
          type: "Time"
          pointer: false
      - db_type: "timestamptz"
        nullable: true
        go_type:
          import: "time"
          type: "Time"
          pointer: true
      - db_type: "timestamptz"
        go_type:
          import: "time"
          type: "Time"
          pointer: false
      - db_type: "jsonb"
        go_type:
          type: "[]byte"
          pointer: false
      - db_type: "jsonb"
        nullable: true
        go_type:
          pointer: true
          type: "[]byte"
      - db_type: "pg_catalog.numeric"
        nullable: true
        go_type:
          import: "github.com/shopspring/decimal"
          package: "decimal"
          type: "Decimal"
          pointer: true
      - db_type: "pg_catalog.numeric"
        go_type:
          import: "github.com/shopspring/decimal"
          package: "decimal"
          type: "Decimal"

sql:
  - schema: schema.sql
    queries: queries/
    engine: postgresql
    codegen:
      - out: db
        plugin: golang
        options:
          package: db
          sql_package: "pgx/v4"
          emit_pointers_for_null_types: true
          emit_empty_slices: true
          emit_interface: true
          emit_result_struct_pointers: true
          emit_enum_valid_method: false
          emit_all_enum_values: true
          omit_unused_structs: true
          emit_methods_with_db_argument: true
          query_parameter_limit: 0
          emit_per_file_queries: true
          emit_err_nil_if_no_rows: true
          emit_tracing:
            import: "example"
            package: "tracing"
            code:
              - "ctx, tracer := tracing.StartTracing(ctx, \"{{.StructName}}.{{.MethodName}}\")"
              - "defer tracer.End()"
